# =============================================================================
# Eclipse Mosquitto 2.x — MQTT broker config for PDM Pilot
# =============================================================================
# Dev: allow_anonymous true. Auth added in production (prompt 24).
# =============================================================================

# Persistence: retained messages and session data (survives container restart)
persistence true
persistence_location /mosquitto/data

# Log to file
log_dest file /mosquitto/log/mosquitto.log
log_type error
log_type warning
log_type notice
log_type information

# MQTT protocol — internal only (containers); no TLS
listener 1883

# MQTT over TLS — port 8883 (production / cross-segment); mutual TLS
listener 8883
cafile /mosquitto/certs/ca.crt
certfile /mosquitto/certs/server.crt
keyfile /mosquitto/certs/server.key
require_certificate true

# WebSockets protocol
listener 9001
protocol websockets

# Dev only — no auth; enable auth in production
allow_anonymous true

# Production hardening
max_keepalive 120
message_size_limit 10240
